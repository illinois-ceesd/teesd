<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JustKernels: Testing Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xpacc_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JustKernels
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">XPACC Multiphysics simluation application</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('testing_reference.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Testing Reference </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The intent of this page is to provide some useful information about the PlasCom2 testing framework.</p>
<ul>
<li><a class="el" href="testing_reference.html#running">Running Tests</a></li>
<li><a class="el" href="testing_reference.html#addtest">Adding Tests</a></li>
<li><a class="el" href="testing_reference.html#addsuite">Adding Suites</a></li>
<li><a class="el" href="testing_reference.html#anatomy">Anatomy of PlasCom2 Testing</a></li>
</ul>
<h1><a class="anchor" id="running"></a>
Running Tests</h1>
<p>The PlasCom2 testing can be run after configuration and building with:</p>
<blockquote class="doxtable">
<p>make test </p>
</blockquote>
<p>At this point CMake/CTest will take over and stage-in all of the testing data in Testing/Data to the build/test area and execute all of the enabled tests. Typically, the default tests will take around 5-10 minutes on a modern laptop to run, and will use 4 MPI ranks. Upon completion, the results of all the tests will be summarized. A summary of test failures is presented at the end of the tests summary.</p>
<dl class="section note"><dt>Note</dt><dd>Any failing tests with <b>FAILS</b> in the test name is a known, non-critical failure. Any failing test <em>without</em> the FAILS keyword could indicate that your PlasCom2 build is broken in some way.</dd></dl>
<p>There are several places where the actual output of the tests and the testing framework can be reviewed:</p>
<ul>
<li>&lt;build&gt;/Testing/parallel_test_output.txt - is a log of the output of the actual test functions that are executed during the testing</li>
<li>&lt;build&gt;/Testing/Temporary/LastTest.log - is a log of the output of testing framework and* the output of the testing functions.</li>
</ul>
<p>Users may also directly run the PlasCom2 test drivers to execute only a suite of tests at-a-time. Any data required by the suite should be staged into the current directory when attempting to directly run the PlasCom2 test drivers. In general individual suites can be run as follows:</p>
<blockquote class="doxtable">
<p>cd &lt;build&gt;/Testing<br />
../bin/plascom2_test -n &lt;serial_suite_name&gt; </p>
</blockquote>
<p>-or- </p><blockquote class="doxtable">
<p>mpiexec -n 4 ../bin/plascom2_parallel_test -n &lt;parallel_suite_name&gt; </p>
</blockquote>
<dl class="section note"><dt>Note</dt><dd>Running single individual tests is not currently supported, but is coming soon.</dd></dl>
<h1><a class="anchor" id="addtest"></a>
Adding Tests</h1>
<p>This section is about adding tests to an existing suite of tests. Adding tests to an existing suite is the most common way to add a test. Adding tests to existing suites that use a <em>suite driver</em> is trivial. This section will focus on adding legacy tests for existing suites that do not use a suite driver.</p>
<p>The general procedure is as follows:</p>
<ul>
<li><a class="el" href="testing_reference.html#addfunc">Add or edit a test function</a></li>
<li><a class="el" href="testing_reference.html#addproto">Add a test function prototype</a></li>
<li><a class="el" href="testing_reference.html#addcall">Add appropriate calls to the test functions to the PlasCom2 testing object</a></li>
</ul>
<h2><a class="anchor" id="addfunc"></a>
Add a Test Function</h2>
<p>Test functions for testing suites without suite drivers are directly called by the PC2 testing framework. Test functions are defined in Testing/src/Test&lt;XXX&gt;.C. Test functions (and suite drivers) must all follow the standard prototypes.</p>
<p>Serial prototype: </p><blockquote class="doxtable">
<p>void Test&lt;MyName&gt;(ix::test::results &amp;); </p>
</blockquote>
<p>Parallel prototype: </p><blockquote class="doxtable">
<p>void Test&lt;MyName&gt;(ix::test::results &amp;,ix::comm::CommunicatorObject &amp;); </p>
</blockquote>
<p>Examples of testing functions can be found in any file Testing/src/Test&lt;XXX&gt;.C. Example serial and parallel suite drivers can be found in Testing/src/TestExample.C.</p>
<p>To add your own test function, open or create a file Testing/src/Test&lt;XXX&gt;.C and add a new function with the required function prototype. Alternatively, edit an existing test function to add your test. Inside your test function, for every test you want to add, add a call to ix::test::results::UpdateResult to indicate whether your test passes or fails. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TestMyTest(ix::test::results &amp;testResults)</div><div class="line">{</div><div class="line">   testResults.UpdateResult(<span class="stringliteral">&quot;MySuite:MyTest:Ran&quot;</span>,<span class="keyword">true</span>);</div><div class="line">}</div></div><!-- fragment --><p>In this example, the test function is named <em>TestMyTest</em>, the name of the suite is <em>MySuite</em>, and the name of the test is <em>MyTest:Ran</em>. It is hardcoded to <em>true</em> for a function pass, and simply indicates that the test function has been executed.</p>
<p>For new test functions (or new suite drivers) that are not called from an existing suite driver, the next step for getting the new function called by the testing framework is to add the test function's prototype to Testing/include/ExternalTestingFunctions.H. This step is explained in <a class="el" href="testing_reference.html#addproto">Add a Testing Function Prototype</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Test functions for suites with a suite driver can have arbitrary function prototypes and do not require any additional steps beyond writing the function and calling it from the suite driver.</dd></dl>
<h2><a class="anchor" id="addproto"></a>
Add a Testing Function Prototype</h2>
<p>Adding a function prototype for each function to be called by the framework is required to provide the PlasCom2 testing object knowledge about the function it must call. This step is easily done by editing Testing/include/ExternalTestingFunctions.H and adding a function prototype for your testing function(s).</p>
<p>For the example testing function provided in the <a class="el" href="testing_reference.html#addfunc">Add a Test Function</a> section, one would edit Testing/include/ExternalTestingFunctions.H and add the following line(s):</p>
<div class="fragment"><div class="line"><span class="comment">// new test function by [myname]</span></div><div class="line"><span class="keywordtype">void</span> TestMyTest(ix::test::results &amp;);</div></div><!-- fragment --><p>The next step is adding the appropriate calls to the PlasCom2 Testing Object, which is explained in <a class="el" href="testing_reference.html#addcall">Add new Testing Function to Testing Object</a>.</p>
<h2><a class="anchor" id="addcall"></a>
Add new Testing Function to Testing Object</h2>
<p>The PlasCom2 Testing Object is driven by the PlasCom2 test drivers when tests are executed. In order for your new test function(s) or suite driver(s) to be called by the testing framework, calls to those must be added to the PlasCom2 Testing Object by editing Testing/include/PlasCom2Test.H.</p>
<p>Typically, 3 things must be added to the PlasCom2 Testing Object for each new test function or suite driver.</p>
<ul>
<li><a class="el" href="testing_reference.html#wrapper">Function Wrapper</a></li>
<li><a class="el" href="testing_reference.html#processcall">Call in Process method</a></li>
<li><a class="el" href="testing_reference.html#callbyname">Call by Name</a></li>
</ul>
<h3><a class="anchor" id="wrapper"></a>
Function Wrapper</h3>
<p>Function wrappers are added to the PlasCom2 Testing Object by editing Testing/include/PlasCom2Test.H.</p>
<p>Function wrappers with a standard form are used to access testing functions (and suite drivers) in the PlasCom2 Testing Object. We follow a specific form to make automation easier. There are many existing function wrappers that can be used as examples in PlasCom2Test.H.</p>
<p>Following the example from previous sections, the test function wrapper that would be added here is:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Test__MySuite__MyTest(ix::test::results &amp;result)</div><div class="line">{ TestMyTest(result); };</div></div><!-- fragment --><p>For a parallel test, the wrapper looks as follows:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Test__MySuite__MyParallelTest(ix::test::results &amp;result)</div><div class="line">{ TestMyParallelTest(result,_communicator); };</div></div><!-- fragment --><p>Once the required wrappers are implemented, the PlasCom2 Testing Object will access the test function(s) (or suite driver) through calls to the wrapper.</p>
<p>Calls to the wrapper(s) must be added in two places, in the <em>Process</em> method and in the <em>RunTest</em> method. The Process method executes <em>all</em> of the tests while the RunTest method executes testing suites by name.</p>
<h3><a class="anchor" id="processcall"></a>
Call in Process method</h3>
<p>Add a call to the wrapper in the plascom2::TestingObject::Process method, or plascom2::ParallelTestingObject::Process as is appropriate for a serial or parallel test, respectively.</p>
<h3><a class="anchor" id="callbyname"></a>
Call by Name</h3>
<p>Add a call to the wrapper in the plascom2::TestingObject::RunTest method in the appropriate suite-specific construct (or plascom2::ParallelTestingObject::RunTest for a parallel test).</p>
<h1><a class="anchor" id="addsuite"></a>
Adding Suites</h1>
<p>The high level steps for adding a new testing suite are:</p>
<ul>
<li><a class="el" href="testing_reference.html#newsuite">Adding a new testing suite</a></li>
<li><a class="el" href="testing_reference.html#addlist">Add new suite to suite lists</a></li>
</ul>
<h2><a class="anchor" id="newsuite"></a>
Adding a new testing suite</h2>
<p>A new suite is required when developers add tests that do not fit into any existing suite. Creating a new test suite is simply done by specifying an unknown suite name in a call to ix::test::results::UpdateResult. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TestMyTest(ix::test::results &amp;testResults)</div><div class="line">{</div><div class="line">  ...</div><div class="line">  testResults.UpdateResult(<span class="stringliteral">&quot;MyNewSuite:MyTestName&quot;</span>,<span class="keyword">true</span>);</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><p>It is highly recommended when adding new suites to use a suite driver. Use of the suite driver greatly reduces the complexity and steps for adding new tests in the suite. Example suite drivers can be found in Testing/src/TestExample.C as ExamplesSerialTestDriver, and ExamplesParallelTestDriver.</p>
<dl class="section note"><dt>Note</dt><dd>For brand new suites, developers can copy Testing/src/TestExample.C to a test file name of their choice and rename the functions appropriately. Then add the new suite driver to the framework similarly to the steps outlined in previous sections for new testing functions.</dd></dl>
<h2><a class="anchor" id="addlist"></a>
Add new suite to suite lists</h2>
<p>This step makes the testing framework aware of your new suite. If your new suite has serial tests, add a line for the suite containing only the name of the suite to Testing/Scripts/serialUnitSuites.txt. If your new suite has parallel tests, add the suite name to Testing/Scripts/parallelUnitSuites.txt.</p>
<p>After adding suites, PlasCom2 needs to be reconfigured to make the testing framework aware of the new suite.</p>
<dl class="section note"><dt>Note</dt><dd>At configuration (cmake) time, a verbose listing of tests and suites can be generated if one uses the option _-DSHOWTESTS=1_. This can be a convenient way to indicate whether your suite and tests have been properly added.</dd></dl>
<h1><a class="anchor" id="additional"></a>
Additional Topics</h1>
<p>This section will talk about FAIL keyword, suite drivers, optional test exclusions, adding platforms, running tests, and debugging tests.</p>
<h1><a class="anchor" id="anatomy"></a>
Anatomy of PlasCom2 Testing</h1>
<p>The PlasCom2 testing framework consists of several parts:</p><ul>
<li><a class="el" href="testing_reference.html#parser">Code Parser</a></li>
<li><a class="el" href="testing_reference.html#object">PlasCom2 Testing Object</a></li>
<li><a class="el" href="testing_reference.html#drivers">Test Drivers</a></li>
<li><a class="el" href="testing_reference.html#functions">Testing Functions</a></li>
<li><a class="el" href="testing_reference.html#suites">Test Suites</a></li>
<li><a class="el" href="testing_reference.html#tests">Tests</a></li>
<li><a class="el" href="testing_reference.html#platforms">Platform Drivers</a></li>
<li><a class="el" href="testing_reference.html#cmake">CMake/CTest</a></li>
</ul>
<h2><a class="anchor" id="parser"></a>
Code Parser</h2>
<p>The Code Parser automatically detects tests added by user/developers. User/developers do not often need to fiddle with the Code Parser. The Code Parser looks through all files matching the "Test*" pattern in the Testing/src subdirectory and finds any calls to "UpdateResult" and extracts the "SuiteName" and "TestName" from that call. The parse happens at PlasCom2 config-time (i.e. CMake). The lists of testing suites and tests is accumulated, pruned, and eventually provided to CMake/CTest at PlasCom2 configuration time and test time. One can find the parse/prune functionality in Testing/CMakeLists.txt.</p>
<h2><a class="anchor" id="object"></a>
PlasCom2 Testing Object</h2>
<p>The PlasCom2 Testing Object is an object that encapsulates all the unit and integrated tests implemented for PlasCom2. It is implemented in Testing/include/PlasCom2Test.H. Each "Testing Function" is called as in a member method of the PlasCom2 Testing Object.</p>
<h2><a class="anchor" id="drivers"></a>
Test Drivers</h2>
<p>The PlasCom2 Test Drivers execute the tests optionally by suite or test name. There is a parallel test driver (plascom2_parallel_test) and a serial test driver (plascom2_test). Each of these drivers instantiate a PlasCom2 Testing Object and drive it to run the tests.</p>
<h2><a class="anchor" id="functions"></a>
Testing Functions</h2>
<p>The Testing Functions are those functions that the PlasCom2 Testing Object calls from its member methods that implement the tests. The user writes these Testing Functions. Testing Functions must be <em>void</em>. Each Testing Function needs to be added to the testing prototypes in Testing/include/ExternalTestingFunctions.H and a PlasCom2 Testing Object member method added in Testing/include/PlasCom2Test.H to call the Testing Function.</p>
<h2><a class="anchor" id="suites"></a>
Test Suites</h2>
<p>Test Suites are collections of Tests. Every Test belongs to a Suite. The testing framework executes each Test Suite in-turn when the user invokes 'make test'. See <a class="el" href="testing_reference.html#addsuite">Adding Suites</a> for how to add new suites to the testing framework.</p>
<h2><a class="anchor" id="tests"></a>
Tests</h2>
<p>Tests are defined, from the testing framework's perspective, as a call to "UpdateResults" method of the ix::test::results object. The arguments to UpdateResults indicate the "SuiteName" and the "TestName" for the test:</p>
<blockquote class="doxtable">
<p>results.UpdateResults("&lt;SuiteName&gt;:&lt;TestName&gt;"); </p>
</blockquote>
<ul>
<li>The "TestName" is arbitrary, user-defined</li>
<li>The "SuiteName" should be an existing suite -OR- see addsuites</li>
</ul>
<p>The results for every named test will be reported by CTest when the user invokes: </p><blockquote class="doxtable">
<p>make test </p>
</blockquote>
<h2><a class="anchor" id="platforms"></a>
Platform Drivers</h2>
<p>Platform drivers are scripts that help the tests navigate the resource management system (e.g. batch queue) for each platform. Users do not typically need to tinker with these, but mostly they can be found in Testing/Platforms</p>
<h2><a class="anchor" id="cmake"></a>
CMake/CTest</h2>
<p>CMake/CTest - the PlasCom2 testing framework (currently) uses CMake to help parse and prune the lists of tests to run for any given configuration. CTest is used to run the tests and report the results on all platforms. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Apr 10 2020 12:24:30 for JustKernels by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
